<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css" />
    <script src="https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js"></script>
    <title>MapLibre GL JS</title>
    <!-- <link type="text/css" rel="stylesheet" href="style.css" /> -->
    <style>
        /* html * {
            font-size: 1em !important;
            color: #000 !important;
            font-family: Arial !important;
        }

        body {
            margin: 0;
            position: relative;
        } */

        #map {
            width: 900px;
            height: 600px;
        }

        .legend {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
        }
    </style>
</head>

<body>
    <div class="harita">
        <div id="map"></div>
        <div class="legend">
            <input type="file" id="fileInput" accept=".json, .geojson">
            <button id="removeDataButton" style="display: none;">Remove Imported Data</button>
            <p>Import a geojson file</p>
            <button id="resetView">Reset View</button>
            <input type="checkbox" id="legendCheckbox">
            <label for="legendCheckbox">Show Legend</label>
            <div>
                <label for="colorSlider">Polygon Color:</label>
                <input type="range" id="colorSlider" min="0" max="360" step="1" value="0">
            </div>
            <div id="coordinates"></div>
        </div>
    </div>

</body>
<!-- <script src="script.js"></script> -->
<script>
    const map = new maplibregl.Map({
        container: 'map',
        style: 'https://tiles.basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
        center: [10.5, 51],
        zoom: 5
    });
    map.addControl(new maplibregl.NavigationControl());

    document.getElementById('fileInput').addEventListener('change', function (event) {
        document.getElementById('colorSlider').value = '0';
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const contents = e.target.result;
                const data = JSON.parse(contents);
                addDataSource(data);
                document.getElementById('removeDataButton').style.display = 'inline';
                document.getElementById('fileInput').value = '';
            };
            reader.readAsText(file);
        }
    });

    document.getElementById('removeDataButton').addEventListener('click', function () {
        removeDataSource();
    });

    document.getElementById('colorSlider').addEventListener('input', function (event) {
        const hue = event.target.value;
        const color = `hsl(${hue}, 100%, 50%)`;
        map.setPaintProperty('data-layer', 'fill-color', color);
    });

    document.getElementById('resetView').addEventListener('click', function () {
        map.flyTo({
            center: [10.5, 51],
            zoom: 5,
            pitch: 0,
            bearing: 0
        });
    })

    function addDataSource(data) {
        if (map.getSource('data')) {
            map.removeLayer('data-layer');
            map.removeSource('data');
        }
        map.addSource('data', {
            type: 'geojson',
            data: data
        });

        map.addLayer({
            id: 'data-layer',
            type: 'fill',
            source: 'data',
            paint: {
                'fill-color': 'rgba(128, 128, 128, 0.5)',
                'fill-outline-color': 'red'
            }
        });
    }

    function removeDataSource() {
        if (map.getSource('data')) {
            map.removeLayer('data-layer');
            map.removeSource('data');
            document.getElementById('removeDataButton').style.display = 'none';
            document.getElementById('colorSlider').value = '0';
        }
    }

    function updateCoordinates() {
        const coordinatesContainer = document.getElementById('coordinates');
        const { lng, lat } = map.getCenter();
        const zoom = map.getZoom().toFixed(2);
        const pitch = map.getPitch().toFixed(2);
        coordinatesContainer.innerHTML = `Longitude: ${lng.toFixed(3)} | Latitude: ${lat.toFixed(3)}<br>Zoom: ${zoom} | Pitch: ${pitch}`;
    }

    map.on('move', updateCoordinates);

    map.on('load', updateCoordinates);
</script>

</html>